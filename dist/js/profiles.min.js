var SIM=SIM||{};SIM.PROFILES={init:function(){this.variables(),this.events(),this.buildProfiles()},variables:function(){this.body=$("body"),this.section=this.body.find("section.profiles"),this.container=this.section.find(".container"),this.close=this.section.find(".btn-close"),this.modal=this.body.find(".import-modal"),this.textarea=this.modal.find("textarea")},events:function(){var e=this;e.close.click(function(t){t.preventDefault(),$(".js-profiles").removeClass("active"),e.section.removeClass("active"),e.body.addClass("sidebar-mobile-open")}),e.container.on("click",".profile",function(t){t.preventDefault();let i=$(this);e.loadProfile(i),e.close.click()}),e.container.on("click",".add-profile",function(t){t.preventDefault(),e.addProfile($(this).parent().prev().data("index")+1)}),e.container.on("click",".import-profile",function(t){t.preventDefault(),e.modal.addClass("open"),e.textarea.focus()}),e.container.on("click",".import-th",function(t){t.preventDefault(),t.stopPropagation();let i=e.container.find(".profile").last().data("index")+1;e.importProfile(preset_th,i)}),e.container.on("click",".import-dw",function(t){t.preventDefault(),t.stopPropagation();let i=e.container.find(".profile").last().data("index")+1;e.importProfile(preset_dw,i)}),e.container.on("click",".import-gl",function(t){t.preventDefault(),t.stopPropagation();let i=e.container.find(".profile").last().data("index")+1;e.importProfile(preset_gl,i)}),e.container.on("click",".delete-profile",function(t){t.preventDefault(),t.stopPropagation(),e.deleteProfile($(this).parents(".profile"))}),e.container.on("click",".profile input",function(e){e.preventDefault(),e.stopPropagation(),$(this).addClass("edit")}),e.container.on("keyup",".profile input",function(e){if("Enter"==e.key){$(this).removeClass("edit");let e=$(this).val(),t=$(this).parents(".profile"),i=t.data("index"),a=JSON.parse(localStorage[mode+i]);a.profilename=e,localStorage[mode+i]=JSON.stringify(a),t.hasClass("active")&&(globalThis.profilename=e),$(this).blur(),SIM.UI.updateSession()}}),e.container.on("click",".edit-profilename",function(e){e.preventDefault(),e.stopPropagation(),$(this).siblings("input").addClass("edit")}),e.container.on("click",".export-profile",function(t){t.preventDefault(),t.stopPropagation(),e.exportProfile($(this).parents(".profile"))}),e.modal.find(".btn-close").click(function(t){t.preventDefault(),e.modal.removeClass("open")}),e.textarea.on("input",function(t){let i=$(this).val();if(i&&i.length>20){let t=e.container.find(".profile").last().data("index")+1;e.importProfile(i,t),e.modal.removeClass("open"),$(this).val("")}})},deleteProfile(e){let t=e.data("index");delete localStorage[mode+t];let i=0;for(let e=0;e<40;e++)localStorage[mode+e]&&(localStorage[mode+i]=localStorage[mode+e],i!=e&&delete localStorage[mode+e],i++);globalThis.profileid==t&&(globalThis.profileid=0),this.buildProfiles(),SIM.UI.addAlert("Profile deleted")},addProfile(e){let t=mode+e,i=mode+(globalThis.profileid||0);if(void 0===localStorage[t]){localStorage[t]=localStorage[i];let a=JSON.parse(localStorage[t]);a.profilename="Profile "+(e+1),localStorage[t]=JSON.stringify(a)}this.buildProfiles()},loadProfile(e){var t=e.data("index");let i=mode+t,a=mode+(globalThis.profileid||0);globalThis.profileid=t,void 0===localStorage[i]&&(localStorage[i]=localStorage[a]),SIM.UI.loadSession(),SIM.UI.updateSidebar(),SIM.SETTINGS.buildSpells(),SIM.SETTINGS.buildBuffs(),SIM.SETTINGS.buildTalents(),SIM.SETTINGS.buildRunes(),this.body.find("nav > ul > li.active > p").click();let o=JSON.parse(localStorage[i]);SIM.UI.addAlert(`${o.profilename} loaded`),e.addClass("active"),e.siblings().removeClass("active")},buildProfiles(){const e=this;e.container.empty();let t=globalThis.profileid||0,i=0,a=Object.keys(localStorage).filter(e=>e.indexOf(mode)>-1).length;do{if(!localStorage[mode+i])continue;if("undefined"===localStorage[mode+i]){delete localStorage[mode+i];continue}let o=JSON.parse(localStorage[mode+i]),r=e.getItemsHTML(o),l=e.getTalents(o),s=$(`\n                <div data-index="${i}" class="profile ${t==i?"active":""}">\n                    <div class="title"><input name="profilename" type="text" value="${o.profilename}" /><div class="edit-profilename">${svgPencil}</div></div>\n                    <p>${o.race} level ${o.level}</p>\n                    <p></p>\n                    <p>${l}</p>\n                    <ul>${r}</ul>\n                    <div class="export-profile" title="Export">${svgExport}</div>\n                    ${a>1?`<div class="delete-profile" title="Delete">${svgThrash}</div>`:""}\n                </div>`);e.container.append(s)}while(i++<40);e.container.append(`<div>\n            <div class="add-profile">${svgAdd}<p>Add Profile</p></div>\n            <div class="import-profile">${svgImport}<p>Import Profile</p>\n            ${"sod"==mode?'<div class="import-container">\n                    <div class="import-gl" style="width: 100%;">Gladiator Stance</div>\n                    <div class="import-dw">60 DW Fury</div>\n                    <div class="import-th">50 2H Arms</div>\n                </div>':""}\n            </div>\n            </div>`)},getItemsHTML(e){const t=this;let i="";for(let a in e.gear)if("twohand"==a||"mainhand"==a||"offhand"==a)for(let o of e.gear[a])if(o.selected){let a=t.getItem(o.id);a&&(i+=t.getItemHTML(a,e))}for(let a in e.gear)if("custom"!=a&&"twohand"!=a&&"mainhand"!=a&&"offhand"!=a)for(let o of e.gear[a])if(o.selected){let a=t.getItem(o.id);a&&(i+=t.getItemHTML(a,e))}return i},getItemHTML(e,t){let i="";if(void 0!==t.runes&&t.runes[e.slot])for(let a of t.runes[e.slot])if(a.selected){let t=runes[e.slot].filter(e=>e.id==a.id)[0];t?i=`<img src="https://wow.zamimg.com/images/wow/icons/medium/${t.iconname}.jpg">`:a.selected=!1}return`<li data-quality="${e.q}"><p>${e.name}</p> ${i}</li>`},getItem(e){for(let t in gear)for(let i of gear[t])if(i.id==e)return i},getTalents:e=>`${e.talents[0].t.reduce((e,t)=>e+t,0)} / ${e.talents[1].t.reduce((e,t)=>e+t,0)} / ${e.talents[2].t.reduce((e,t)=>e+t,0)}`,exportProfile:function(e){let t=e.data("index"),i=JSON.parse(localStorage[mode+t]),a={};for(let e in i)"string"==typeof i[e]&&(a[e]=i[e]);a.buffs=i.buffs,a.talents=i.talents,a.gear={};for(let e in i.gear)for(let t of i.gear[e])t.selected&&(a.gear[e]=t.id);a.rotation=[];for(let e of i.rotation)if(e.active){let t={};t.id=e.id,void 0!==e.duration&&(t.duration=e.duration),void 0!==e.durationactive&&(t.durationactive=e.durationactive),void 0!==e.timetoend&&(t.timetoend=e.timetoend),void 0!==e.timetoendactive&&(t.timetoendactive=e.timetoendactive),void 0!==e.timetostart&&(t.timetostart=e.timetostart),void 0!==e.timetostartactive&&(t.timetostartactive=e.timetostartactive),void 0!==e.crusaders&&(t.crusaders=e.crusaders),void 0!==e.haste&&(t.haste=e.haste),void 0!==e.procblock&&(t.procblock=e.procblock),void 0!==e.rageblock&&(t.rageblock=e.rageblock),void 0!==e.rageblockactive&&(t.rageblockactive=e.rageblockactive),void 0!==e.executestacks&&(t.executestacks=e.executestacks),void 0!==e.executestacksactive&&(t.executestacksactive=e.executestacksactive),void 0!==e.minrage&&(t.minrage=e.minrage),void 0!==e.minrageactive&&(t.minrageactive=e.minrageactive),void 0!==e.maxrage&&(t.maxrage=e.maxrage),void 0!==e.maxrageactive&&(t.maxrageactive=e.maxrageactive),void 0!==e.maincd&&(t.maincd=e.maincd),void 0!==e.maincdactive&&(t.maincdactive=e.maincdactive),void 0!==e.priorityap&&(t.priorityap=e.priorityap),void 0!==e.priorityapactive&&(t.priorityapactive=e.priorityapactive),void 0!==e.unqueue&&(t.unqueue=e.unqueue),void 0!==e.unqueueactive&&(t.unqueueactive=e.unqueueactive),void 0!==e.exmacro&&(t.exmacro=e.exmacro),void 0!==e.globals&&(t.globals=e.globals),void 0!==e.globalsactive&&(t.globalsactive=e.globalsactive),void 0!==e.bloodsurge&&(t.bloodsurge=e.bloodsurge),void 0!==e.swingreset&&(t.swingreset=e.swingreset),void 0!==e.afterswing&&(t.afterswing=e.afterswing),void 0!==e.alwaystails&&(t.alwaystails=e.alwaystails),void 0!==e.alwaysheads&&(t.alwaysheads=e.alwaysheads),void 0!==e.zerkerpriority&&(t.zerkerpriority=e.zerkerpriority),void 0!==e.swordboard&&(t.swordboard=e.swordboard),void 0!==e.resolve&&(t.resolve=e.resolve),void 0!==e.switchstart&&(t.switchstart=e.switchstart),void 0!==e.switchtime&&(t.switchtime=e.switchtime),void 0!==e.switchrage&&(t.switchrage=e.switchrage),void 0!==e.switchdefault&&(t.switchdefault=e.switchdefault),void 0!==e.switchtimeactive&&(t.switchtimeactive=e.switchtimeactive),a.rotation.push(t)}a.runes={};for(let e in i.runes)for(let t of i.runes[e])t.selected&&(a.runes[e]=t.id);a.enchant={};for(let e in i.enchant)for(let t of i.enchant[e])t.selected&&(a.enchant[e]||(a.enchant[e]=[]),a.enchant[e].push(t.id));let o=btoa(JSON.stringify(a));navigator.clipboard.writeText(o),SIM.UI.addAlert("Profile copied to clipboard")},importProfile(e,t){const i=this;try{let a="{"==e[0]?JSON.parse(e.trim()):JSON.parse(atob(e.trim()));localStorage[mode+(globalThis.profileid||0)]||SIM.UI.loadSession();let o=JSON.parse(localStorage[mode+(globalThis.profileid||0)]);for(let e in a)"string"==typeof a[e]&&(o[e]=a[e]);o.buffs=a.buffs,o.talents=a.talents,o.gear={};for(let e in a.gear)"custom"!=e&&(o.gear[e]=[{id:a.gear[e],selected:!0}]);for(let e of spells)o.rotation.filter(t=>t.id==e.id).length||o.rotation.push(e);for(let e of o.rotation){let t=a.rotation.filter(t=>t.id==e.id)[0];t?(e.active=!0,void 0!==t.duration&&(e.duration=t.duration),void 0!==t.durationactive&&(e.durationactive=t.durationactive),void 0!==t.timetoend&&(e.timetoend=t.timetoend),void 0!==t.timetoendactive&&(e.timetoendactive=t.timetoendactive),void 0!==t.timetostart&&(e.timetostart=t.timetostart),void 0!==t.timetostartactive&&(e.timetostartactive=t.timetostartactive),void 0!==t.crusaders&&(e.crusaders=t.crusaders),void 0!==t.haste&&(e.haste=t.haste),void 0!==t.procblock&&(e.procblock=t.procblock),void 0!==t.rageblock&&(e.rageblock=t.rageblock),void 0!==t.rageblockactive&&(e.rageblockactive=t.rageblockactive),void 0!==t.executestacks&&(e.executestacks=t.executestacks),void 0!==t.executestacksactive&&(e.executestacksactive=t.executestacksactive),void 0!==t.minrage&&(e.minrage=t.minrage),void 0!==t.minrageactive&&(e.minrageactive=t.minrageactive),void 0!==t.maxrage&&(e.maxrage=t.maxrage),void 0!==t.maxrageactive&&(e.maxrageactive=t.maxrageactive),void 0!==t.maincd&&(e.maincd=t.maincd),void 0!==t.maincdactive&&(e.maincdactive=t.maincdactive),void 0!==t.priorityap&&(e.priorityap=t.priorityap),void 0!==t.priorityapactive&&(e.priorityapactive=t.priorityapactive),void 0!==t.unqueue&&(e.unqueue=t.unqueue),void 0!==t.unqueueactive&&(e.unqueueactive=t.unqueueactive),void 0!==t.exmacro&&(e.exmacro=t.exmacro),void 0!==t.globals&&(e.globals=t.globals),void 0!==t.globalsactive&&(e.globalsactive=t.globalsactive),void 0!==t.bloodsurge&&(e.bloodsurge=t.bloodsurge),void 0!==t.afterswing&&(e.afterswing=t.afterswing),void 0!==t.swingreset&&(e.swingreset=t.swingreset),void 0!==t.alwaystails&&(e.alwaystails=t.alwaystails),void 0!==t.alwaysheads&&(e.alwaysheads=t.alwaysheads),void 0!==t.zerkerpriority&&(e.zerkerpriority=t.zerkerpriority),void 0!==t.swordboard&&(e.swordboard=t.swordboard),void 0!==t.resolve&&(e.resolve=t.resolve),void 0!==t.switchstart&&(e.switchstart=t.switchstart),void 0!==t.switchtime&&(e.switchtime=t.switchtime),void 0!==t.switchrage&&(e.switchrage=t.switchrage),void 0!==t.switchdefault&&(e.switchdefault=t.switchdefault),void 0!==t.switchtimeactive&&(e.switchtimeactive=t.switchtimeactive)):e.active=!1}o.runes={};for(let e in a.runes)o.runes[e]=[{id:a.runes[e],selected:!0}];o.enchant={};for(let e in a.enchant){o.enchant[e]=[];for(let t of a.enchant[e])o.enchant[e].push({id:t,selected:!0})}let r=mode+(t||0);localStorage[r]=JSON.stringify(o),i.buildProfiles(),SIM.UI.addAlert(o.profilename+" imported")}catch(e){SIM.UI.addAlert("Invalid profile")}}};const svgImport='<svg width="24"height="24"viewBox="0 0 24 24"fill="none"xmlns="http://www.w3.org/2000/svg"><path  d="M5 9.98193V19.9819H19V9.98193H15V7.98193H21V21.9819H3V7.98193H9V9.98193H5Z" fill="currentColor"/><path  d="M13.0001 2H11.0001V14.0531L8.46451 11.5175L7.05029 12.9317L12 17.8815L16.9498 12.9317L15.5356 11.5175L13.0001 14.053V2Z" fill="currentColor"/></svg>',svgExport='<svg width="24"height="24"viewBox="0 0 24 24"fill="none"xmlns="http://www.w3.org/2000/svg"><path  d="M16.9498 5.96781L15.5356 7.38203L13 4.84646V17.0421H11V4.84653L8.46451 7.38203L7.05029 5.96781L12 1.01807L16.9498 5.96781Z"  fill="currentColor"/><path  d="M5 20.9819V10.9819H9V8.98193H3V22.9819H21V8.98193H15V10.9819H19V20.9819H5Z"  fill="currentColor"/></svg>',svgPencil='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16"><path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/></svg>',svgThrash='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/></svg>',svgAdd='<svg width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  xmlns="http://www.w3.org/2000/svg">  <path    d="M12 4C11.4477 4 11 4.44772 11 5V11H5C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13H11V19C11 19.5523 11.4477 20 12 20C12.5523 20 13 19.5523 13 19V13H19C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11H13V5C13 4.44772 12.5523 4 12 4Z" fill="currentColor"  /></svg>';